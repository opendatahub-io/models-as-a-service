---
apiVersion: telemetry.istio.io/v1
kind: Telemetry
metadata:
  name: maas-gateway-metrics
  namespace: openshift-ingress
spec:
  selector:
    matchLabels:
      gateway.networking.k8s.io/gateway-name: maas-default-gateway
  metrics:
  - providers:
    - name: prometheus
    overrides:
    - match:
        metric: REQUEST_DURATION
        mode: CLIENT_AND_SERVER
      tagOverrides:
        tier:
          operation: UPSERT
          value: request.headers["x-maas-tier"]
    - match:
        metric: REQUEST_COUNT
        mode: CLIENT_AND_SERVER
      tagOverrides:
        tier:
          operation: UPSERT
          value: request.headers["x-maas-tier"]
