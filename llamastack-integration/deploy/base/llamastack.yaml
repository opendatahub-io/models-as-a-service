apiVersion: serving.kserve.io/v1alpha1
kind: LLMInferenceService
metadata:
  name: llamastack
  annotations:
    alpha.maas.opendatahub.io/tiers: '[]'
spec:
  replicas: 1
  router:
    route: {}
    # Connect to MaaS-enabled gateway
    gateway:
      refs:
        - name: maas-default-gateway
          namespace: openshift-ingress
  template:
    containers:
      - name: llamastack
        image: "meta-llama/llamastack:latest"
        imagePullPolicy: Always
        command: ["llama", "stack", "run"]
        args:
        - /app/config.yaml
        - --port
        - "8000"
        - --ssl-certfile
        - /var/run/kserve/tls/tls.crt
        - --ssl-keyfile
        - /var/run/kserve/tls/tls.key
        env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.name
          - name: POD_NAMESPACE
            valueFrom:
              fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
          - name: LLAMASTACK_CONFIG
            value: "/app/config.yaml"
        ports:
          - name: https
            containerPort: 8000
            protocol: TCP
        volumeMounts:
          - name: llamastack-config
            mountPath: /app
            readOnly: true
        livenessProbe:
          httpGet:
            path: /v1/health
            port: https
            scheme: HTTPS
        readinessProbe:
          httpGet:
            path: /v1/health
            port: https
            scheme: HTTPS
        resources:
          limits:
            cpu: 500m
            memory: 1Gi
          requests:
            cpu: 100m
            memory: 256Mi
    volumes:
      - name: llamastack-config
        configMap:
          name: llamastack-config